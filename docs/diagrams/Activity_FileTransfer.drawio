<mxfile host="app.diagrams.net" modified="2025-12-21T00:00:00.000Z" agent="Mozilla/5.0" version="21.0.0" type="device">
  <diagram id="activity-file-transfer" name="Activity - File Transfer">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- Title -->
        <mxCell id="title" value="Activity Diagram: Quy trình tải file hoàn chỉnh" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="350" height="30" as="geometry"/>
        </mxCell>
        
        <!-- Swimlanes -->
        <mxCell id="lane-user" value="Người dùng" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="50" y="70" width="200" height="800" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-client" value="Client App" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="250" y="70" width="280" height="800" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-network" value="Network Layer" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="530" y="70" width="250" height="800" as="geometry"/>
        </mxCell>
        
        <mxCell id="lane-server" value="Relay Server" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="780" y="70" width="220" height="800" as="geometry"/>
        </mxCell>
        
        <!-- Initial Node -->
        <mxCell id="initial" value="" style="ellipse;html=1;shape=startState;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="135" y="100" width="30" height="30" as="geometry"/>
        </mxCell>
        
        <!-- Action: Chọn file -->
        <mxCell id="a1" value="Tìm kiếm hoặc&#xa;nhập mã PIN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="95" y="160" width="110" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Flow -->
        <mxCell id="f1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="initial" target="a1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Decision: Mode -->
        <mxCell id="d1" value="Mode?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="340" y="155" width="80" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="f2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a1" target="d1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: P2P Mode -->
        <mxCell id="a2-p2p" value="Khám phá Peer&#xa;(UDP Broadcast)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="580" y="120" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Action: Relay Mode -->
        <mxCell id="a2-relay" value="Kết nối&#xa;Relay Server" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="580" y="200" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="f3a" value="P2P" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d1" target="a2-p2p">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="f3b" value="Relay" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d1" target="a2-relay">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Merge after mode selection -->
        <mxCell id="merge1" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#333333;strokeColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="625" y="275" width="30" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="f4a" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a2-p2p" target="merge1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="f4b" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a2-relay" target="merge1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Tìm file -->
        <mxCell id="a3" value="Tìm kiếm file&#xa;theo query/PIN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="310" y="265" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="f5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="merge1" target="a3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Decision: Tìm thấy? -->
        <mxCell id="d2" value="Tìm&#xa;thấy?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="340" y="340" width="60" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="f6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a3" target="d2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Hiển thị lỗi -->
        <mxCell id="a-error1" value="Hiển thị&#xa;'Không tìm thấy'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="95" y="345" width="110" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="f7a" value="Không" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d2" target="a-error1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Chọn file để tải -->
        <mxCell id="a4" value="Hiển thị kết quả&#xa;Người dùng chọn file" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="95" y="430" width="110" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="f7b" value="Có" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d2" target="a4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="370" y="430"/>
              <mxPoint x="260" y="430"/>
              <mxPoint x="260" y="455"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Action: Khởi tạo download -->
        <mxCell id="a5" value="Khởi tạo download&#xa;Tạo TransferProgress" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="310" y="430" width="130" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="f8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a4" target="a5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Decision: Resume? -->
        <mxCell id="d3" value="Resume&#xa;từ chunk&#xa;trước?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="335" y="510" width="80" height="70" as="geometry"/>
        </mxCell>
        
        <mxCell id="f9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a5" target="d3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Fork for parallel chunk download -->
        <mxCell id="fork1" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#333333;strokeColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="617.5" y="530" width="45" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="f10a" value="Không" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d3" target="fork1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="f10b" value="Có" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="d3" target="fork1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="375" y="600"/>
              <mxPoint x="640" y="600"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Loop: Download chunks -->
        <mxCell id="loop-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="545" y="580" width="190" height="180" as="geometry"/>
        </mxCell>
        <mxCell id="loop-label" value="loop [for each chunk]" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="585" width="120" height="18" as="geometry"/>
        </mxCell>
        
        <!-- Action: Request chunk -->
        <mxCell id="a6" value="Request chunk&#xa;(với Range header)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="570" y="615" width="130" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="fork1" target="a6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Server gửi chunk -->
        <mxCell id="a7" value="Đọc file&#xa;Gửi chunk" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="830" y="615" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a6" target="a7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Verify chunk hash -->
        <mxCell id="a8" value="Nhận chunk&#xa;Verify hash" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="570" y="680" width="130" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a7" target="a8">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Update progress -->
        <mxCell id="a9" value="Cập nhật progress&#xa;Ghi chunk vào file" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="310" y="680" width="130" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a8" target="a9">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Hiển thị progress -->
        <mxCell id="a10" value="Hiển thị&#xa;tiến trình %" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="95" y="680" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a9" target="a10">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Join after loop -->
        <mxCell id="join1" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#333333;strokeColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="352.5" y="760" width="45" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="f16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a9" target="join1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Verify complete file -->
        <mxCell id="a11" value="Verify file hash&#xa;(SHA-256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="310" y="810" width="130" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="join1" target="a11">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Action: Hoàn thành -->
        <mxCell id="a12" value="Thông báo&#xa;'Tải xong!'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="95" y="810" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="f18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a11" target="a12">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Final Node -->
        <mxCell id="final" value="" style="ellipse;html=1;shape=endState;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="130" y="870" width="30" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="f19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="a12" target="final">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Loop back from error -->
        <mxCell id="f-retry" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;dashed=1;strokeColor=#999999;" edge="1" parent="1" source="a-error1" target="a1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="70" y="370"/>
              <mxPoint x="70" y="185"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
